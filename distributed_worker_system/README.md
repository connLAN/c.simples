# 分布式工作系统

这是一个简单的分布式工作系统，由中央服务器和多个工作服务器组成。中央服务器负责任务分发和结果收集，工作服务器负责执行任务并返回结果。

## 系统架构

系统由以下主要组件组成：

1. **中央服务器**：
   - 管理工作服务器的注册和状态
   - 分发任务给可用的工作服务器
   - 收集和处理任务结果

2. **工作服务器**：
   - 连接到中央服务器并注册
   - 接收和执行任务
   - 将任务结果返回给中央服务器
   - 定期发送心跳消息以保持连接

3. **通用组件**：
   - 通信协议：定义服务器间通信的消息格式
   - 网络工具：提供套接字通信功能
   - 日志系统：记录系统运行状态
   - 环形缓冲区：用于任务队列

## 编译指南

系统使用Makefile进行编译。确保你的系统上安装了GCC和pthread库。

编译整个系统：

```bash
make
```

清理编译文件：

```bash
make clean
```

## 运行指南

### 启动中央服务器

```bash
./build/central_server [port]
```

参数：
- `port`：（可选）服务器监听端口，默认为8888

### 启动工作服务器

```bash
./build/worker_server [server_ip] [server_port]
```

参数：
- `server_ip`：（可选）中央服务器IP地址，默认为127.0.0.1
- `server_port`：（可选）中央服务器端口，默认为8888

## 文件结构

```
.
├── central_server/
│   ├── central_server.c    # 中央服务器主程序
│   ├── worker_registry.c   # 工作服务器注册表实现
│   ├── worker_registry.h   # 工作服务器注册表头文件
│   ├── task_manager.c      # 任务管理器实现
│   └── task_manager.h      # 任务管理器头文件
├── worker_server/
│   └── worker_server.c     # 工作服务器主程序
├── common/
│   ├── comm_protocol.h     # 通信协议定义
│   ├── logger.c            # 日志系统实现
│   ├── logger.h            # 日志系统头文件
│   ├── net_utils.c         # 网络工具实现
│   ├── net_utils.h         # 网络工具头文件
│   ├── ring_buffer.c       # 环形缓冲区实现
│   └── ring_buffer.h       # 环形缓冲区头文件
├── Makefile                # 构建系统
└── README.md               # 项目说明
```

## 示例用法

1. 启动中央服务器：

```bash
./build/central_server
```

2. 在另一个终端启动工作服务器：

```bash
./build/worker_server
```

3. 可以启动多个工作服务器来增加系统的处理能力。

## 扩展功能

系统可以通过以下方式进行扩展：

1. 实现更复杂的任务分配策略
2. 添加负载均衡功能
3. 实现工作服务器的动态扩展和收缩
4. 添加任务优先级支持
5. 实现任务依赖关系处理

## 注意事项

- 系统使用TCP套接字进行通信，确保防火墙不会阻止相关端口
- 工作服务器会在连接断开后尝试重新连接到中央服务器
- 日志文件会在程序运行目录下生成